!function(){function t(t,i,e){this.image=new Image,this.frameWidth=i,this.frameHeight=e;var s=this;this.image.onload=function(){s.framesPerRow=Math.floor(s.image.width/s.frameWidth)},this.image.src=t}function i(t,i,e,s){for(var a=[],n=0,h=0,o=e;s>=o;o++)a.push(o);this.update=function(){h==i-1&&(n=(n+1)%a.length),h=(h+1)%i},this.draw=function(i,e){var s=Math.floor(a[n]/t.framesPerRow),h=Math.floor(a[n]%t.framesPerRow);u.drawImage(t.image,h*t.frameWidth,s*t.frameHeight,t.frameWidth,t.frameHeight,i,e,t.frameWidth,t.frameHeight)}}function e(t,i,e,s){this.x=t||0,this.y=i||0,this.dx=e||0,this.dy=s||0}function s(t,i,s){this.x=t,this.y=i,this.width=c,this.height=c,this.type=s,e.call(this,t,i,0,0),this.update=function(){this.dx=-g.speed,this.advance()},this.draw=function(){u.save(),u.translate(.5,.5),u.drawImage(y.imgs[this.type],this.x,this.y),u.restore()}}function a(){g.isFalling=!0;for(var t=0;t<f.length;t++){f[t].update(),f[t].draw();var i;g.minDist(f[t])<=g.height/2+c/2&&(i=180*Math.atan2(g.y-f[t].y,g.x-f[t].x)/Math.PI)>-130&&-50>i&&(g.isJumping=!1,g.isFalling=!1,g.y=f[t].y-g.height+5,g.dy=0)}f[0]&&f[0].x<-c&&f.splice(0,1)}function n(){g.update(),g.draw()}function h(){stop||(A(h),u.clearRect(0,0,m.width,m.height),w.draw(),a(),n())}function o(){f=[],g.reset(),stop=!1,r=2,d=15;for(var t=0;30>t;t++)f.push(new s(t*(c-3),l-r,"grass"));w.reset(),h()}var r,d,m=document.getElementById("canvas"),u=m.getContext("2d"),g={},f=[],c=52,l=m.height-c,y=function(){function t(t,e){"loading"===this[t][e].status&&(this[t][e].status="loaded",i++,i===this.totalAssest&&"function"==typeof this.finished&&this.finished())}this.imgs={bg:"../assets/images/bg.png",grass:"../assets/images/grass.png",avatar_normal:"../assets/images/redneck-run.png"};var i=0,e=Object.keys(this.imgs).length;return this.totalAssest=e,this.downloadAll=function(){var i,e=this;for(var s in this.imgs)this.imgs.hasOwnProperty(s)&&(i=this.imgs[s],function(e,s){e.imgs[s]=new Image,e.imgs[s].status="loading",e.imgs[s].name=s,e.imgs[s].onload=function(){t.call(e,"imgs",s)},e.imgs[s].src=i}(e,s))},{imgs:this.imgs,totalAssest:this.totalAssest,downloadAll:this.downloadAll}}();y.finished=function(){o()};var w=function(){return this.draw=function(){u.drawImage(y.imgs.bg,0,0)},this.reset=function(){},{draw:this.draw,reset:this.reset}}();e.prototype.advance=function(){this.x+=this.dx,this.y+=this.dy},e.prototype.minDist=function(t){var i,e,s,a=1/0,n=Math.max(Math.abs(this.dx),Math.abs(this.dy),Math.abs(t.dx),Math.abs(t.dy)),h=1/n,o={},r={};o.x=this.x+this.width/2,o.y=this.y+this.height/2,r.x=t.x+t.width/2,r.y=t.y+t.height/2;for(var d=0;1>d;d+=h)i=o.x+this.dx*d-(r.x+t.dx*d),e=o.y+this.dy*d-(r.y+t.dy*d),s=i*i+e*e,a=Math.min(a,s);return Math.sqrt(a)};var g=function(s){s.width=80,s.height=80,s.speed=4,s.gravity=1,s.dy=0,s.jumpDy=-10,s.isFalling=!1,s.isJumping=!1,s.sheet=new t("../assets/images/redneck-run.png",s.width,s.height),s.walkAnim=new i(s.sheet,5,0,4),s.jumpAnim=new i(s.sheet,5,3,3),s.fallAnim=new i(s.sheet,5,0,0),s.anim=s.walkAnim,e.call(s,0,0,0,s.dy);var a=0;return s.update=function(){v.space&&0===s.dy&&!s.isJumping&&(s.isJumping=!0,s.dy=s.jumpDy,a=12),v.space&&a&&(s.dy=s.jumpDy),a=Math.max(a-1,0),this.advance(),(s.isFalling||s.isJumping)&&(s.dy+=s.gravity),s.anim=s.dy>0?s.fallAnim:s.dy<0?s.jumpAnim:s.walkAnim,s.anim.update()},s.draw=function(){s.anim.draw(s.x,s.y)},s.reset=function(){s.x=164,s.y=250},s}(Object.create(e.prototype));s.prototype=Object.create(e.prototype);var p={32:"space"},v={};for(var x in p)p.hasOwnProperty(x)&&(v[p[x]]=!1);document.onkeydown=function(t){var i=t.keyCode?t.keyCode:t.charCode;p[i]&&(t.preventDefault(),v[p[i]]=!0)},document.onkeyup=function(t){var i=t.keyCode?t.keyCode:t.charCode;p[i]&&(t.preventDefault(),v[p[i]]=!1)};var A=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();y.downloadAll()}();